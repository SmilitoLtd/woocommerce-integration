(()=>{if(window.SmilitoIntegrationRegistered=window.SmilitoIntegrationRegistered||!1,!window.SmilitoIntegrationRegistered){window.SmilitoIntegrationRegistered=!0,window.SmilitoIntegrationOrderId=window.SmilitoIntegrationOrderId||null;const t=window.location.href.indexOf("/checkout/order-received/")>-1,e="#smilito_integration",o={targetSelector:e,claim:!!t},i=t=>!!document.querySelector(t),n=(t,e)=>{if(i(t))return void e();const o=new MutationObserver((n=>{for(const r of n)if(i(t)){e(),o.disconnect();break}}));o.observe(document,{childList:!0,subtree:!0})},r=(t,e)=>{const o=()=>{const o=new MutationObserver(e),i=document.querySelector(t);o.observe(i,{childList:!0,subtree:!0,attributes:!0,characterData:!0})};i(t)?o():n(t,(function(){o()}))},a=async()=>{const t=SmilitoIntegrationOrderId||null;try{const e=t?`/wp-json/smilito-integration/v1/basket-data?order-id=${t}`:"/wp-json/smilito-integration/v1/basket-data",o=await fetch(e);if(!o.ok)throw new Error("Response error");return o.json()}catch(t){return console.error("Failed to fetch basket data",t),null}},c=async()=>{try{const t=await fetch("/wp-json/smilito-integration/v1/login",{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Login response error");return(await t.json()).jwt}catch(t){return console.error("Failed to fetch JWT",t),null}},s=async()=>(await a()).basket_value,d=async()=>(await a()).basket_id,l=()=>{n(e,(()=>{window.Smilito&&window.Smilito.run&&window.Smilito.run(o)}))},u=()=>{const t=document.createElement("script");t.id="smilito-integration-script",t.src="https://typescript-integration.smilito.io/smilito-typescript-integration.js",t.type="module",t.defer=!0,t.onload=m,document.body.appendChild(t)},w=()=>!!document.querySelector("script#smilito-integration-script"),m=async()=>{const t={basketValue:s,basketId:d,jwt:c,callback:()=>{l()}};try{window.Smilito.init(t)}catch(t){console.error("Smilito could not be initialised...",t)}},p=()=>{w()?l():u()};jQuery((function(t){["updated_cart_totals","updated_checkout","added_to_cart","removed_from_cart","updated_wc_div","removed_coupon","wc_cart_emptied","wc_fragments_refreshed"].forEach((e=>{t(document).on(e,(function(){p()}))})),[".wc-block-components-totals-footer-item-tax-value"].forEach((t=>{r(t,(function(){p()}))}))})),document.addEventListener("DOMContentLoaded",(async()=>{p()}))}})();