(()=>{if(window.SmilitoIntegrationRegistered=window.SmilitoIntegrationRegistered||!1,!window.SmilitoIntegrationRegistered){window.SmilitoIntegrationRegistered=!0,window.SmilitoIntegrationOrderId=window.SmilitoIntegrationOrderId||null,window.SmilitoIntegrationOrderSuccess=window.SmilitoIntegrationOrderSuccess||null;const t=window.location.href.indexOf("/checkout/order-received/")>-1,e="#smilito_integration",i={targetSelector:e,claim:t},o=t=>!!document.querySelector(t),n=(t,e)=>{if(o(t))return void e();const i=new MutationObserver((n=>{for(const r of n)if(o(t)){e(),i.disconnect();break}}));i.observe(document,{childList:!0,subtree:!0})},r=(t,e)=>{const i=()=>{const i=new MutationObserver(e),o=document.querySelector(t);i.observe(o,{childList:!0,subtree:!0,attributes:!0,characterData:!0})};o(t)?i():n(t,(function(){i()}))},a=(async()=>{const t=SmilitoIntegrationOrderId||null,e=t&&SmilitoIntegrationOrderSuccess?"true":"false";try{const i=t?`/wp-json/smilito-integration/v1/integration-data?order-id=${t}&order-success=${e}`:"/wp-json/smilito-integration/v1/integration-data",o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Response error");return o.json()}catch(t){return console.error("Failed to fetch basket data",t),null}})(),c=async()=>(await a).basket_value,d=async()=>(await a).basket_id,s=async()=>(await a).jwt,l=()=>{n(e,(()=>{window.Smilito&&window.Smilito.run&&window.Smilito.run(i)}))},u=()=>{const t=document.createElement("script");t.id="smilito-integration-script",t.src="https://typescript-integration.smilito.io/smilito-typescript-integration.js",t.type="module",t.defer=!0,t.onload=m,document.body.appendChild(t)},w=()=>!!document.querySelector("script#smilito-integration-script"),m=async()=>{const t={basketValue:c,basketId:d,jwt:s,callback:()=>{l()}};try{window.Smilito.init(t)}catch(t){console.error("Smilito could not be initialised...",t)}},g=()=>{w()?l():u()};jQuery((function(t){["updated_cart_totals","updated_checkout","added_to_cart","removed_from_cart","updated_wc_div","removed_coupon","wc_cart_emptied","wc_fragments_refreshed"].forEach((e=>{t(document).on(e,(function(){g()}))})),[".wc-block-components-totals-footer-item-tax-value"].forEach((t=>{r(t,(function(){g()}))}))})),document.addEventListener("DOMContentLoaded",(async()=>{g()}))}})();